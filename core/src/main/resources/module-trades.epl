@Name('OPEN_ORDER_WINDOW')
create
    window OpenOrderWindow.win:keepall()
as
    GenericOrder;

@Name('INSERT_INTO_OPEN_ORDER_WINDOW')
@RunTimeOnly()
insert into
    OpenOrderWindow
select
    *
from
    GenericOrder;

@Name('DELETE_FROM_OPEN_ORDER_WINDOW')
@RunTimeOnly()
on
    OrderStatus(status = Status.EXECUTED or status = Status.CANCELED) as orderStatus
delete from
    OpenOrderWindow as openOrderWindow
where
    orderStatus.parentOrder.number = openOrderWindow.number;

@Name('LOG_TRANSACTION_SUMMARY')
@Subscriber(className='com.algoTrader.service.TransactionServiceImpl$LogTransactionSummarySubscriber')
@RunTimeOnly()
select
    fill,
    orderStatus
from
    pattern [every fill=Fill -> orderStatus=OrderStatus(parentOrder.number = fill.parentOrder.number, status = Status.EXECUTED or status = Status.CANCELED)];

@Name('PROPAGATE_ORDER_STATUS')
@Subscriber(className='com.algoTrader.service.OrderService.propagateOrderStatus')
select
    *
from
    OrderStatus;

@Name('PROPAGATE_FILL')
@Priority(1)
@Subscriber(className='com.algoTrader.service.TransactionService.propagateFill')
select
    *
from
    Fill;

@Name('CREATE_TRANSACTION')
@Subscriber(className='com.algoTrader.service.TransactionService.createTransaction')
select
    *
from
    Fill;
